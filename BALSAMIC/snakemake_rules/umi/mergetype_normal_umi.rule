# vim: syntax=python tabstop=4 expandtab
# coding: utf-8

rule mergeBam_normal_umiconsensus:
  input:
    fasta = config["reference"]["reference_genome"],
    bam = expand(umi_dir + "{mysample}.consensusfiltered.umi.bam", mysample=normal_sample)
  output:
    bam = umi_dir + "normal.umi_consensusfiltered.merged.bam"
  benchmark:
    Path(benchmark_dir, 'mergeBam_normal_umiconsensus_' + "{mysample}.tsv".format(mysample=normal_sample)).as_posix()
  singularity:
    Path(singularity_image, config["bioinfo_tools"].get("picard") + ".sif").as_posix()
  params:
    conda = config["bioinfo_tools"].get("picard"),
    picard = params.common.picard_RG_normal,
    sample = normal_sample
  threads:
    get_threads(cluster_config, "mergeBam_normal_umiconsensus")
  message:
    "Replace ReadGroups using picard for normal sample {params.sample}"
  shell:
        """
source activate {params.conda};
picard AddOrReplaceReadGroups {params.picard} INPUT={input.bam} OUTPUT={output.bam}; 
samtools index {output.bam};
        """
